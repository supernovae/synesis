{% extends "base.html" %}
{% block title %}RAG Gaps - Synesis Admin{% endblock %}
{% block content %}
<h1>RAG Corpus Gaps</h1>
<p style="color: var(--muted); margin-bottom: 1.5rem;">
    Unresolved failures suggest areas where the RAG corpus may need additional documentation.
    {{ total_unresolved }} unresolved failure(s) found.
</p>

{% if gap_clusters %}
{% for lang, failures in gap_clusters.items() %}
<div class="card">
    <h2 style="font-size: 1rem; margin-bottom: 0.75rem;">{{ lang }} ({{ failures|length }} gaps)</h2>
    <table>
        <thead>
            <tr><th>Type</th><th>Task Description</th><th>Error</th><th></th></tr>
        </thead>
        <tbody>
            {% for f in failures[:20] %}
            <tr>
                <td><span class="badge badge-{{ f.get('error_type', 'runtime') }}">{{ f.get('error_type', '?') }}</span></td>
                <td>{{ f.get('task_description', '')[:100] }}</td>
                <td>{{ f.get('error_output', '')[:80] }}{% if f.get('error_output', '')|length > 80 %}...{% endif %}</td>
                <td><a class="link" href="/admin/failures/{{ f.get('failure_id', '') }}">view</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endfor %}
{% else %}
<div class="empty">No RAG corpus gaps detected. All failures have resolutions.</div>
{% endif %}
{% endblock %}
