# SCC for Kaniko pipeline: allow capabilities needed for UBI base image unpack
# (lsetxattr security.capability on newgidmap/newuidmap).
# Apply with: oc apply -f pipelines/manifests/kaniko-scc.yaml
# Then: oc adm policy add-scc-to-user kaniko-capabilities -z pipeline-runner-dspa -n <DS_PROJECT>
#
# Or use bootstrap-pipelines.sh which applies this and grants to pipeline SA.
---
apiVersion: security.openshift.io/v1
kind: SecurityContextConstraints
metadata:
  name: kaniko-capabilities
allowPrivilegedContainer: false
allowHostDirVolumePlugin: false
allowHostNetwork: false
allowHostPorts: false
allowHostPID: false
allowHostIPC: false
allowPrivilegeEscalation: true
runAsUser:
  type: RunAsAny
seLinuxContext:
  type: MustRunAs
supplementalGroups:
  type: RunAsAny
volumes:
  - configMap
  - downwardAPI
  - emptyDir
  - persistentVolumeClaim
  - projected
  - secret
# Kaniko needs these to set xattrs when unpacking UBI (newgidmap/newuidmap)
allowedCapabilities:
  - CHOWN
  - DAC_OVERRIDE
  - FOWNER
  - SETFCAP
  - SETGID
  - SETUID
defaultAddCapabilities: null
requiredDropCapabilities: null
users: []
# Bootstrap adds: system:serviceaccount:<DS_PROJECT>:pipeline-runner-dspa
