# PIPELINE DEFINITION
# Name: synesis-manager-modelcar-build-only
# Description: Build only â€” model already on PVC (resume after failed build)
# Inputs:
#    pvc_name: str [Default: 'modelcar-build-pvc']
components:
  comp-build-and-push-modelcar-baked:
    executorLabel: exec-build-and-push-modelcar-baked
deploymentSpec:
  executors:
    exec-build-and-push-modelcar-baked:
      container:
        command:
        - sh
        - -c
        - export CONTEXT_DIR=/data && /usr/local/bin/ecr-login-and-buildah-modelcar-pvc.sh
          '660250927410.dkr.ecr.us-east-1.amazonaws.com/byron-ai-registry::manager::manager'
        image: 660250927410.dkr.ecr.us-east-1.amazonaws.com/byron-ai-registry:buildah-ecr
        resources:
          cpuRequest: 2.0
          memoryLimit: 60.129542144
          memoryRequest: 8.589934592
          resourceCpuRequest: 2000m
          resourceMemoryLimit: 56Gi
          resourceMemoryRequest: 8Gi
pipelineInfo:
  description: "Build only \u2014 model already on PVC (resume after failed build)"
  name: synesis-manager-modelcar-build-only
root:
  dag:
    tasks:
      build-and-push-modelcar-baked:
        cachingOptions:
          enableCache: true
        componentRef:
          name: comp-build-and-push-modelcar-baked
        taskInfo:
          name: build-and-push-modelcar-baked
  inputDefinitions:
    parameters:
      pvc_name:
        defaultValue: modelcar-build-pvc
        isOptional: true
        parameterType: STRING
schemaVersion: 2.1.0
sdkVersion: kfp-2.16.0
---
platforms:
  kubernetes:
    deploymentSpec:
      executors:
        exec-build-and-push-modelcar-baked:
          emptyDirMounts:
          - mountPath: /var/lib/containers
            volumeName: buildah-storage
          imagePullPolicy: Always
          pvcMount:
          - componentInputParameter: pvc_name
            mountPath: /data
            pvcNameParameter:
              componentInputParameter: pvc_name
          secretAsEnv:
          - keyToEnv:
            - envVar: AWS_ACCESS_KEY_ID
              secretKey: AWS_ACCESS_KEY_ID
            - envVar: AWS_SECRET_ACCESS_KEY
              secretKey: AWS_SECRET_ACCESS_KEY
            optional: false
            secretName: aws-ecr-credentials
            secretNameParameter:
              runtimeValue:
                constant: aws-ecr-credentials
          - keyToEnv:
            - envVar: AWS_SESSION_TOKEN
              secretKey: AWS_SESSION_TOKEN
            optional: true
            secretName: aws-ecr-session-token
            secretNameParameter:
              runtimeValue:
                constant: aws-ecr-session-token
